<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Your Next Clue</title>
  <meta name="description" content="Multi-gate puzzle: trivia, music notes, repair, grid — randomized order." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;650;750&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="bg"></div>
  <div class="noise"></div>

  <main class="wrap">
    <section class="card" id="app">
      <header class="topbar">
        <div class="brand">
          <div class="brandTitle">Your Next Clue</div>
          <div class="brandSub" id="subtitle">Clear each gate. Misses reset streaks.</div>
        </div>

        <div class="topbarRight">
          <nav class="steps" aria-label="sections" id="stepsNav">
            <button class="step" id="stepTrivia" type="button"><span class="dot"></span>Trivia</button>
            <button class="step" id="stepNote" type="button"><span class="dot"></span>Music Notes</button>
            <button class="step" id="stepRepair" type="button"><span class="dot"></span>Repair</button>
            <button class="step" id="stepGrid" type="button"><span class="dot"></span>Grid</button>
          </nav>

          <!-- ✅ icon-only theme toggle; JS injects Sun/Moon SVG -->
          <button class="iconBtn" id="themeToggle" type="button" aria-label="Toggle theme" title="Toggle theme"></button>
        </div>
      </header>

      <div class="layout">
        <section class="panel">
          <div class="panelHead">
            <div>
              <h1 class="panelTitle" id="panelTitle">Gate</h1>
              <p class="panelDesc" id="panelDesc">Loading…</p>
            </div>

            <div class="statusPill" id="statusPill">Locked</div>
          </div>

          <div class="panelBody">

            <!-- TRIVIA -->
            <section class="stage" id="stageTrivia" aria-label="Trivia gate">
              <div class="arena">
                <div class="arenaTop">
                  <div class="kpis">
                    <div class="kpi">
                      <div class="kLabel">Streak</div>
                      <div class="kValue"><span id="streak">0</span> / <span id="triviaTarget">15</span></div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Remaining</div>
                      <div class="kValue"><span id="remaining">0</span></div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Category</div>
                      <div class="kValue mono" id="category">—</div>
                    </div>
                  </div>

                  <div class="btnRow">
                    <button class="btn ghost" id="resetProgress" type="button">Reset progress</button>
                  </div>
                </div>

                <div class="qCard">
                  <div class="qLabel">Question</div>
                  <div class="qText" id="question">Loading…</div>

                  <div class="answerRow">
                    <input id="answer" type="text" autocomplete="off" spellcheck="false" placeholder="Type answer, press Enter" />
                    <button class="btn primary" id="submitAnswer" type="button">Submit</button>
                  </div>

                  <div class="msg" id="triviaMsg" aria-live="polite"></div>
                </div>

                <div class="rules">
                  <div class="rule"><span class="dotMini"></span>Answers are case-insensitive. Minor punctuation/spacing differences don’t matter.</div>
                  <div class="rule"><span class="dotMini"></span>Miss = streak reset to 0.</div>
                </div>
              </div>
            </section>

            <!-- MUSIC NOTES -->
            <section class="stage" id="stageNote" aria-label="Music notes gate">
              <div class="arena">
                <div class="arenaTop">
                  <div class="kpis">
                    <div class="kpi">
                      <div class="kLabel">Streak</div>
                      <div class="kValue"><span id="noteStreak">0</span> / <span id="noteTarget">5</span></div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Allowed</div>
                      <div class="kValue mono">A B C D E F G</div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Policy</div>
                      <div class="kValue mono">Single octave</div>
                    </div>
                  </div>
                </div>

                <div class="qCard">
                  <div class="qLabel">Audio</div>
                  <div class="qText small">Press “Play note”, then type the note letter (A–G) and press Submit.</div>

                  <div class="btnRow">
                    <button class="btn primary" id="playNote" type="button">Play note</button>
                  </div>

                  <div class="answerRow">
                    <input id="noteAnswer" type="text" autocomplete="off" spellcheck="false" maxlength="4" placeholder="A–G" />
                    <button class="btn primary" id="submitNote" type="button">Submit</button>
                  </div>

                  <div class="msg" id="noteMsg" aria-live="polite"></div>
                </div>

                <div class="rules">
                  <div class="rule"><span class="dotMini"></span>Keyboard entry never auto-submits. Submit is mandatory.</div>
                  <div class="rule"><span class="dotMini"></span>Miss = streak reset to 0.</div>
                </div>
              </div>
            </section>

            <!-- REPAIR -->
            <section class="stage" id="stageRepair" aria-label="Repair gate">
              <div class="arena">
                <div class="arenaTop">
                  <div class="kpis">
                    <div class="kpi">
                      <div class="kLabel">Streak</div>
                      <div class="kValue"><span id="repairStreak">0</span> / <span id="repairTarget">3</span></div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Timer</div>
                      <div class="kValue"><span id="repairTimer">3:30</span></div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Tolerance</div>
                      <div class="kValue mono">≤ 35 wrong chars</div>
                    </div>
                  </div>
                </div>

                <div class="qCard">
                  <div class="qLabel">Fix the text</div>
                  <div class="qText small">
                    Correct the four lines below. <b>Keep the same numbering and line breaks</b>:
                    <span class="mono">1)</span> … newline <span class="mono">2)</span> … newline <span class="mono">3)</span> … newline <span class="mono">4)</span> …
                  </div>

                  <div class="repairBlock">
                    <div class="repairLabel">Broken text</div>
                    <pre class="repairText" id="repairPrompt">Loading…</pre>
                  </div>

                  <div class="answerRow">
                    <textarea id="repairAnswer" class="repairInput" spellcheck="false" placeholder="Paste the corrected version here (4 lines, 1)–4))…"></textarea>
                  </div>

                  <div class="btnRow">
                    <button class="btn primary" id="submitRepair" type="button">Submit</button>
                  </div>

                  <div class="msg" id="repairMsg" aria-live="polite"></div>
                </div>

                <div class="rules">
                  <div class="rule"><span class="dotMini"></span>Timer is strict. Timeout resets streak.</div>
                  <div class="rule"><span class="dotMini"></span>Wrong submissions do not reset your streak — keep editing until it passes.</div>
                </div>
              </div>
            </section>

            <!-- GRID -->
            <section class="stage" id="stageGrid" aria-label="Grid gate">
              <div class="arena">
                <div class="arenaTop">
                  <div class="kpis">
                    <div class="kpi">
                      <div class="kLabel">Streak</div>
                      <div class="kValue"><span id="gridStreak">0</span> / <span id="gridTarget">1</span></div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Directions</div>
                      <div class="kValue mono">15 steps</div>
                    </div>
                    <div class="kpi">
                      <div class="kLabel">Visibility</div>
                      <div class="kValue"><span id="gridTimer">0:30</span></div>
                    </div>
                  </div>

                  <div class="btnRow">
                    <button class="btn ghost" id="resetGrid" type="button">Regenerate</button>
                  </div>
                </div>

                <div class="gridWrap">
                  <div class="qCard">
                    <div class="qLabel">Directions (hide after 30s)</div>
                    <div class="qText small">
                      Memorize the 15 directions. After 30 seconds, they disappear and you must click the full path on the grid.
                      <b>Click start first</b>, then every step, then press Submit.
                    </div>

                    <div class="dirList" id="gridSteps">Loading…</div>

                    <div class="btnRow">
                      <button class="btn primary" id="submitGrid" type="button" disabled>Submit Path</button>
                    </div>

                    <div class="msg" id="gridMsg" aria-live="polite"></div>
                  </div>

                  <div class="gridBoard">
                    <div class="gridLegend">
                      <span class="pill">Start is blue</span>
                      <span class="pill">Your path is green</span>
                    </div>
                    <div class="grid" id="gridBoard"></div>
                  </div>
                </div>

                <div class="rules">
                  <div class="rule"><span class="dotMini"></span>Misclicks are ignored (your progress is kept). The next required cell briefly highlights.</div>
                </div>
              </div>
            </section>

            <!-- REVEAL (REDESIGNED) -->
            <section class="stage" id="stageReveal" aria-label="Reveal stage">
              <div class="revealFull">
                <div class="revealTheme">
                  <!-- ✅ icon-only theme toggle on reveal -->
                  <button class="iconBtn" id="themeToggleReveal" type="button" aria-label="Toggle theme" title="Toggle theme"></button>
                </div>

                <div class="revealHero">
                  <div class="revealKicker">Access Granted</div>
                  <div class="revealHeadline">Payload unlocked</div>
                  <div class="revealLead">
                    You cleared all gates. Enter your passphrase fragments to decrypt the final payload.
                    Passphrase = <span class="mono">fragmentA + fragmentB</span> (lowercase, no spaces).
                  </div>
                </div>

                <div class="qCard">
                  <div class="qLabel">Passphrase</div>
                  <div class="qText small">Enter both fragments, then decrypt.</div>

                  <div class="answerRow">
                    <input id="fragA" type="text" autocomplete="off" spellcheck="false" placeholder="fragmentA" />
                    <input id="fragB" type="text" autocomplete="off" spellcheck="false" placeholder="fragmentB" />
                    <button class="btn primary" id="decryptPoemBtn" type="button">Decrypt</button>
                  </div>

                  <div class="msg" id="revealMsg" aria-live="polite"></div>
                </div>

                <div class="revealCard">
                  <div class="revealCardHead">
                    <div class="revealCardTitle">Decrypted payload</div>
                  </div>
                  <pre class="revealPoem" id="poemText"></pre>
                </div>
              </div>
            </section>

          </div>
        </section>

        <aside class="side">
          <div class="sideCard">
            <div class="sideLabel">Objective</div>
            <div class="sideValue" id="objective">Clear all gates</div>
            <div class="divider"></div>
            <div class="sideText">
              Gate order is randomized on each page load. Misses reset the active gate’s streak.
            </div>
          </div>

          <div class="sideCard">
            <div class="sideLabel">Progress</div>
            <div class="fragLine"><span class="fragKey">Trivia gate</span><span class="fragVal" id="pTrivia">0 / 15</span></div>
            <div class="fragLine"><span class="fragKey">Music Notes gate</span><span class="fragVal" id="pNote">0 / 5</span></div>
            <div class="fragLine"><span class="fragKey">Repair gate</span><span class="fragVal" id="pRepair">0 / 3</span></div>
            <div class="fragLine"><span class="fragKey">Grid gate</span><span class="fragVal" id="pGrid">0 / 1</span></div>
            <div class="divider"></div>
            <div class="sideText muted">
              Grid directions hide after 30 seconds. You must click the full remembered path and then submit.
            </div>
          </div>
        </aside>
      </div>

      <footer class="footer">
        <span>Reload always resets progress.</span>
      </footer>
    </section>
  </main>

  <script src="./trivia_bank.js"></script>
  <script src="./app.js"></script>
</body>
</html>
